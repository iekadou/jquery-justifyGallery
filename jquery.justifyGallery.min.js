/*!
 * jquery-justifyGallery v0.0.4 by @iekadou
 * Copyright (c) 2014 Jonas Braun
 *
 * http://www.noxic-action.de/page/programming/jquery-justifyGallery
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
(function(b){var c=function(e,d){this.$gallery=b(e);this.$images=this.$gallery.find("img");this.options=b.extend({},c.defaults,d);if(!(this.options.hasOwnProperty("images")&&Object.prototype.toString.call(this.options.images)==="[object Array]")){this.registerLoadListeners()}this.justifyCompleted=false;this.currentRefreshCount=0;this.refresh();this.registerWindowResize()};c.defaults={maxRowHeight:"300px",spacing:2,refreshInterval:500,maxRefreshCount:10,resizeCSS:{"min-width":"0","min-height":"0",height:"auto",width:"auto","max-width":"none","max-height":"none"}};c.prototype.append=function(d){var e=this;var g="";for(var h=0;h<d.length;h++){g+='<a href="'+d[h].src+'"><img src="'+d[h].thumb_src+'"></a>'}var f=b(g);f.appendTo(e.$gallery);e.$images=e.$gallery.find("img");e.registerLoadListeners();e.indexImages();e.justify()};c.prototype.indexImages=function(){var e=this;var f=b("body");var d=e.$gallery;d.css("position","relative");e.imgCount=e.$images.length;if(e.$images.length==0){return}e.imageArray=[];e.$images.each(function(){var h=b(this);var g={};var j=h.parent("a");j.removeAttr("class","style");if(j.length==0){h.remove()}else{g.parent=j;g.el=h;var i=h.clone();i.css(e.options.resizeCSS).appendTo(f);g.height=parseInt(i.height());g.width=parseInt(i.width());i.remove();e.imageArray.push(g);if(!(j.parent().is(d))){j.appendTo(d)}j.css({display:"block",overflow:"hidden",position:"absolute"});h.css("position","relative")}});d.children().not("a").each(function(){b(this).remove()});d.children().each(function(){if(b(this).children().length!=b(this).children("img").length){b(this).remove()}})};c.prototype.justify=function(){var s=this;var e=s.$gallery.innerWidth();var g=0;var r=0;var u=[];var k=0;for(var m=0;m<s.imgCount;m++){s.imageArray[m]["el"].css("max-width","100%");r+=parseInt(s.imageArray[m]["width"]);if(g!=m){r+=s.options.spacing}if(r>e){u.push({start:g,end:m,width:r});g=m+1;r=0}}if(g<s.imgCount){u.push({start:g,end:(s.imgCount-1),width:e})}for(var m=0;m<u.length;m++){var p=k;var h=0;var j=u[m]["end"]-u[m]["start"]+1;var o=u[m]["width"]-e;var l=parseInt(o/j);var t=0;var n=parseInt(s.options.maxRowHeight);for(var f=u[m]["start"];f<=u[m]["end"];f++){if(f==u[m]["end"]&&j*l!=o){t=o-j*l}var q=s.imageArray[f]["width"]-l-t;s.imageArray[f]["parent"].css({top:p,left:h});s.imageArray[f]["parent"].css("width",q);h+=q+s.options.spacing;var d=s.imageArray[f]["el"].innerHeight();if(d<n){n=d}if(f==u[m]["end"]){k+=parseInt(n)+s.options.spacing;t=0}}for(var f=u[m]["start"];f<=u[m]["end"];f++){var d=s.imageArray[f]["el"].innerHeight();s.imageArray[f]["parent"].css("height",n);s.imageArray[f]["el"].css("top",parseInt((n-d)/2))}}s.$gallery.css("height",k)};c.prototype.refresh=function(){var d=this;d.indexImages();d.justify();if(d.currentRefreshCount<d.options.maxRefreshCount&&!d.justifyCompleted){setTimeout(function(){d.refresh()},d.options.refreshInterval)}else{d.currentRefreshCount++}};c.prototype.registerLoadListeners=function(){var d=this;d.$gallery.load(function(){d.justifyCompleted=true;d.indexImages();d.justify()});b(window).load(function(){d.indexImages();d.justify()})};c.prototype.registerWindowResize=function(){var d=this;b(window).resize(function(){d.justify()})};c.prototype.replace=function(d){var e=this;e.$gallery.html("");e.append(d)};var a=b.fn.justifyGallery;b.fn.justifyGallery=function(d){return this.each(function(){var e=b(this).data("justifyGallery");if(!e){b(this).data("justifyGallery",(e=new c(b(this),d)));if(typeof d!="undefined"&&d.hasOwnProperty("images")&&Object.prototype.toString.call(d.images)==="[object Array]"){b(this).data("justifyGallery").replace(d.images)}}else{if(typeof d!="undefined"&&d.hasOwnProperty("append")&&d.append==true){if(d.hasOwnProperty("images")&&Object.prototype.toString.call(d.images)==="[object Array]"){b(this).data("justifyGallery").append(d.images)}}else{if(typeof d!="undefined"&&d.hasOwnProperty("replace")&&d.replace==true){if(d.hasOwnProperty("images")&&Object.prototype.toString.call(d.images)==="[object Array]"){b(this).data("justifyGallery").replace(d.images)}}}}})};b.fn.justifyGallery.Constructor=c;b.fn.justifyGallery.noConflict=function(){b.fn.justifyGallery=a;return this}}(jQuery));